{% extends 'base.html' %}
{% load static %}

{% block content %}
    <p>태그: fps</p>
    <div class="container">
        <div class="d-grid gap-2 d-md-flex justify-content-md-between" id="game_list_tag1">
        </div>
    </div>
    <p>태그: rpg</p>
    <div class="container">
        <div class="d-grid gap-2 d-md-flex justify-content-md-between" id="game_list_tag2">
        </div>
    </div>
    <p>모든 게임</p>
    <div class="container">
        <div class="d-grid gap-2 d-md-flex justify-content-md-between" id="game_list_all">
        </div>
    </div>
    <script>
        window.addEventListener("load", async function PageLoad() {
            const param_tag1 = "?tag-q=fps";
            const param_tag2 = "?tag-q=rpg";

            const url_game_list_tag1 = '{% url 'games:game_list' %}' + param_tag1
            const url_game_list_tag2 = '{% url 'games:game_list' %}' + param_tag2
            const url_game_list_all = '{% url 'games:game_list' %}'

            const game_list_tag1 = await temp({
                url: url_game_list_tag1,
                method: 'GET',
                is_token: false
            });

            const game_list_tag2 = await temp({
                url: url_game_list_tag2,
                method: 'GET',
                is_token: false
            });

            const game_list_all = await temp({
                url: url_game_list_all,
                method: 'GET',
                is_token: false
            });

            const data = {
                game_list_tag1: game_list_tag1,
                game_list_tag2: game_list_tag2,
                game_list_all: game_list_all
            }

            console.log(data)
            console.log(Object.keys(data), Object.keys(data)[0], typeof(Object.keys(data)[0]))
            console.log(data[Object.keys(data)[0]])

            for (let key of Object.keys(data)) {
                for (let row of data[key]) {
                    const game_list_div = document.getElementById(key);

                    const card_div = document.createElement('div');
                    card_div.setAttribute("class", "card");
                    card_div.setAttribute("style", "width: 18rem;");

                    const card_img = document.createElement('img');
                    card_img.setAttribute("class", "card-img-top");
                    card_img.setAttribute("width", "100%");
                    card_img.setAttribute("height", "180");
                    if (!row.thumbnail) {
                        card_img.setAttribute("src", "{% static 'image/image_cap.svg' %}");
                    } else {
                        card_img.setAttribute("src", row.thumbnail);
                    }

                    const card_body_div = document.createElement('div');
                    card_body_div.setAttribute("class", "card-body");
                    // card_body_div.setAttribute("class", "card-img-overlay");

                    const card_title = document.createElement('h5');
                    card_title.setAttribute("class", "card-title");
                    card_title.textContent = row.title;

                    const card_content = document.createElement('p');
                    card_content.setAttribute("class", "card-text");
                    card_content.innerHTML = `maker: ${row.maker}<br>평점: ${row.star}`;

                    card_body_div.appendChild(card_title);
                    card_body_div.appendChild(card_content);
                    card_div.appendChild(card_img);
                    card_div.appendChild(card_body_div);
                    game_list_div.appendChild(card_div);
                }
            }
        });
    </script>
{% endblock %}